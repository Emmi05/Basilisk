
<style>
.ui-autocomplete {
    font-size: 14px;
    background-color: #ffffff;
    width: 250px; /* Ajusta este valor según tus necesidades */
    border: 1px solid #cccccc;
    list-style-type: none;
    padding: 0;
    margin: 0;
    max-height: 210px; /* Ajusta este valor según tus necesidades */
    overflow-y: auto; /* Permite el desbordamiento vertical */
    overflow-x: hidden; /* Oculta el desbordamiento horizontal */
}

.ui-autocomplete .ui-menu-item {
    padding: 5px 10px;
    border-bottom: 1px solid #eeeeee;
}
.ui-autocomplete .ui-menu-item:hover {
    background-color: #f5f5f5;
}

    .ui-helper-hidden-accessible div {
        display: none;
    }



</style>
<%- include ('layouts/head.ejs') %>
<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">
        <% if (login) { %> 
        <!-- Sidebar -->
        <%- include ('layouts/sidebar.ejs') %>
        <!-- end sidehar -->
       

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar /header -->
                <%- include ('layouts/header.ejs') %>
                  <!-- header -->
                  <% } %> 
        
       <!-- Begin Page Content -->

        <div class="container-fluid">
            <h1>Registro ventas</h1>
            <form class="row g-3" action="/venta" method="POST" autocomplete="off">

              <div class="col-md-6">
                <label for="cliente" class="form-label">Cliente</label>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Buscar cliente" aria-label="Buscar cliente" aria-describedby="basic-addon2">
                    <span class="input-group-text" id="basic-addon2"><i class="fas fa-search"></i></span>
                </div>
            </div>
            
            <div class="col-md-6">
              <label for="terreno" class="form-label">Terreno</label>
              <select class="form-control" id="id_land" name="id_land">
                  <option value="">Seleccione un terreno</option>
                  <% terrenos.forEach(terreno => { %>
                      <% if (terreno.estado === 'disponible') { %>
                          <option value="<%= terreno.id %>">Manzana <%= terreno.manzana %> Lote <%= terreno.lote %></option>
                      <% } %>
                  <% }); %>
              </select>
          </div>
          
          <div class="col-md-6">
              <label for="interno" class="form-label">Id_terreno</label>
              <input type="text" class="form-control" id="interno" name="interno" disabled placeholder="id terreno">
          </div>
          
          <div class="col-md-6">
            <label for="precio" class="form-label">Precio</label>
            <input type="number" class="form-control" id="precio" name="precio" readonly min="1" placeholder="precio">
        </div>
          
        <!-- Tipo venta -->
            <div class="col-md-6">
              <label for="tipo_venta">Tipo venta:</label>
              <select class="form-control" id="tipo_venta" name="tipo_venta" >
                  <option value="">Seleccionar</option>
                  <option value="contado">Contado</option>
                  <option value="credito">Credito</option>
              </select>

            </div>
                
                
                  <div class="col-md-6">
                    <label for="fecha" name="fecha" class="form-label">Fecha</label>
                    <input type="date" class="form-control" id="fecha_venta" name="fecha_venta">
                  </div>
                  
                  <div class="col-md-6">
                    <label for="inicial" name="inicial" class="form-label">Enganche</label>
                    <input type="number" class="form-control" id="inicial" name="inicial" placeholder="enganche">
                    <div id="rol" class="form-text">
                      Solo debe tener números.         
                   </div>
                  </div>
                  

                  <div class="col-md-6">
                    <label for="n_plazos" name="n_plazos" class="form-label">Cantidad Plazo</label>
                    <input type="number" class="form-control" id="n_cuentas" name="n_cuentas" placeholder="plazos">
                    <div id="rol" class="form-text">
                      Solo debe tener números.         
                   </div>
                  </div>

                  <!-- lO HAGO DESPLEGABLE O QUE JALE EL NOMBRE -->
                  <div class="col-md-6">
                    <label for="vendedor" class="form-label">Vendedor</label>
                    <input type="text" class="form-control" id="vendedor" name="vendedor" value="<%= name %>" disabled>
                </div>
                    
                
                <!-- Cuotas -->
                <div class="col-md-6">
                  <label for="cuotas" class="form-label">Cuotas por mes</label>
                  <input type="number" class="form-control" id="cuotas" name="cuotas" readonly value=`${cuotasTotal}` placeholder="cuotas x mes">
              </div>

              <br> <br> <br> <br>
                <div class="col-12">
                  <a href="/" class="btn btn-secondary">Cancelar</a>
                  <button type="submit" class="btn btn-primary"  value="Save">Guardar</button>
                </div>

              </form>

  

</div>
<!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
<i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<%- include ('layouts/logout.ejs') %>    

<script src="../resources/vendor/jquery/jquery.min.js"></script>
<script src="../resources/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="../resources/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="../resources/scripts/sb-admin-2.min.js"></script>

<!-- Page level plugins -->
<script src="../resources/vendor/datatables/jquery.dataTables.min.js"></script>
<script src="../resources/vendor/datatables/dataTables.bootstrap4.min.js"></script>

<!-- Page level custom scripts -->
<script src="../resources/scripts/datables.js"></script>

     		
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<% if (typeof alert != "undefined")  { %>
 <script>
 Swal.fire({
   title:'<%= alertTitle %>',
   text:'<%= alertMessage %>',
   icon:'<%= alertIcon %>',
   showConfirmButton: <%= showConfirmButton %>,
   timer: <%= timer %>
 }).then(()=>{
   window.location='/<%= ruta %>'
 })
 </script>
<% } %>


<script>
  document.getElementById('id_land').addEventListener('change', function() {
    var terrenoId = this.value;

    // Realizar una solicitud al servidor para obtener los detalles del terreno seleccionado
    fetch('/terreno/' + terrenoId)
        .then(response => response.json())
        .then(data => {
            // Actualizar los campos en la vista con los datos recibidos
            document.getElementById('interno').value = data.id_interno;
            document.getElementById('precio').value = data.precio;
            // Actualizar otros campos aquí según sea necesario
        })
        .catch(error => {
            console.error('Error:', error);
        });
});

</script>

<script>
$(function() {
    var availableTags = [
        <% clientes.forEach(cliente => { %>
            { label: "<%= cliente.name %> <%= cliente.a_paterno %> <%= cliente.a_materno %>", value: "<%= cliente.id %>" },
        <% }); %>
    ];

    $("#id_customer").autocomplete({
        source: availableTags,
        select: function(event, ui) {
            // Cuando se selecciona un cliente, establece el nombre del cliente en el campo de entrada
            $(this).val(ui.item.label);
            // Almacena el ID del cliente como un atributo de datos en el campo de entrada
            $(this).data('customer-id', ui.item.value);
            // Previene el comportamiento predeterminado del Autocomplete
            event.preventDefault();
        }
    });

    // Manejar el envío del formulario
    $("form").submit(function() {
        // Obtener el ID del cliente almacenado como atributo de datos
        var customerId = $("#id_customer").data('customer-id');
        // Establecer el valor del campo de entrada como el nombre del cliente
        $("#id_customer").val(customerId);
        // Continuar con el envío del formulario
        return true;
    });
});

</script> 



<!--  -->
<script>
  document.getElementById('tipo_venta').addEventListener('change', function() {
    var tipoVenta = this.value;

    // Obtener los campos de "inicial" y "n_plazos"
    var inicialField = document.getElementById('inicial');
    var nPlazosField = document.getElementById('n_cuentas');

    // Si se selecciona "contado", deshabilitar los campos de "inicial" y "n_plazos"
    if (tipoVenta === 'contado') {
      inicialField.disabled = true;
      nPlazosField.disabled = true;
    } else {
      // Si se selecciona otra opción, habilitar los campos de "inicial" y "n_plazos"
      inicialField.disabled = false;
      nPlazosField.disabled = false;
    }
  });
</script>
<!-- Después de mostrar el mensaje, redirigir después de un breve tiempo -->
<script>
  // Obtener los campos de "inicial", "n_cuentas" y "cuotas"
  var inicialField = document.getElementById('inicial');
  var nCuentasField = document.getElementById('n_cuentas');
  var cuotasField = document.getElementById('cuotas');
  var saldoPendienteField = document.getElementById('saldo_pendiente'); // Agrega el campo de saldo pendiente

  // Agregar un evento "input" a los campos de "inicial" y "n_cuentas"
  inicialField.addEventListener('input', calcularCuotas);
  nCuentasField.addEventListener('input', calcularCuotas);

  function calcularCuotas() {
      // Obtener el valor de "inicial" y "n_cuentas"
      var inicialValue = parseFloat(inicialField.value) || 0; // Si no hay valor, asignar cero
      var nCuentasValue = parseFloat(nCuentasField.value) || 0; // Si no hay valor, asignar cero

      // Obtener el valor de "precio" y calcular "cuotasTotal"
      var precioTerreno = parseFloat(document.getElementById('precio').value);
      var saldoPendiente = precioTerreno - inicialValue;
      var cuotasTotal = saldoPendiente / nCuentasValue;

      // Actualizar el campo "cuotas" con el valor calculado
      cuotasField.value = isNaN(cuotasTotal) ? '' : cuotasTotal.toFixed(2); // Mostrar el valor solo si es un número válido
      
      // Actualizar el campo "saldo_pendiente" con el valor calculado
      saldoPendienteField.value = isNaN(saldoPendiente) ? '' : saldoPendiente.toFixed(2); // Mostrar el valor solo si es un número válido
      return cuotasTotal;
  }
</script>





<%- include ('./layouts/dash2.ejs') %>

</div>
</body>
</html>